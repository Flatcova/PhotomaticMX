<% layout('admin') -%>
  <div class="hipsum">
    <div class="jumbotron">
      <input type="file" id="selector" multiple>
      <button onclick="upload()">Upload</button>

      <div id="status">Subir fotos para el carrousel, preferencia que sean de 1900x1080</div>
    </div>
  </div>
<script type="text/javascript">
async function upload() {

  var fileInput = document.getElementById('selector');
  var files = fileInput.files;
  var file;

  for (file of files) {
    await complete(file);
  }
  window.location.reload();
}

function complete(file){
    return retrieveNewURL(file)
      .then((uploadLink) => {
          return uploadFile(file, uploadLink);
      }).then((response) => {
        console.log('Se subio el archivo');
      }).catch((err) => {
        console.log(err);
      });
}

// Request to our Node.js server for an upload URL.
function retrieveNewURL(file) {
  var categoriaParam = window.location.search.substring(1);
  return fetch('/admin/servicios/portfolio?name='+file.name+'&'+categoriaParam)
    .then((response) => {
      return response.json();
    }).then((body) => {
      return body.url;
    });
}


// Use XMLHttpRequest to upload the file to S3.
function uploadFile(file, url) {
  console.log('inside uploadFile');
  console.log(file);
  console.log(url);
  return fetch(url, {
    method: 'PUT',
    headers: new Headers({
      'Content-Type': 'binary/octet-stream'
    }),
    body: file
  }).then((response) => {
    console.info(response);
  }).catch((err) => {
    console.log(err);
  })
}
</script>
